<nav>
    <a href="/">Strona Główna</a>
    
    <a href="/admin/manage-users" id="admin-link" style="display: none;">Zarządzaj Użytkownikami</a>
    <a href="/schedule" id="therapist-link" style="display: none;">Panel Terapeuty</a>
    <a href="/driver-schedule" id="driver-link" style="display: none;">Panel Kierowcy</a>
    
    <a href="/logout">Wyloguj (<span id="username-display">...</span>)</a>
</nav>

<hr>
<h3>Twoje uprawnienia (dane z API):</h3>
<pre id="permissions-debug"></pre>

<script>
    // Uruchom ten skrypt, gdy strona się załaduje
    document.addEventListener('DOMContentLoaded', () => {
        fetchUserPermissions();
    });

    async function fetchUserPermissions() {
        try {
            // 1. Odpytaj nowy endpoint backendu
            const response = await fetch('/api/auth/me');

            if (!response.ok) {
                // Jeśli użytkownik nie jest zalogowany (błąd 401), serwer go przekieruje
                // ale na wszelki wypadek obsłużmy też inne błędy
                if (response.status === 401) {
                    console.warn('Użytkownik niezalogowany. Przekierowanie do logowania...');
                    // Możesz tu dodać przekierowanie po stronie klienta,
                    // ale dekorator @login_required już to robi po stronie serwera
                    window.location.href = '/login';
                }
                throw new Error(`Błąd sieci: ${response.statusText}`);
            }

            // 2. Odbierz dane JSON z uprawnieniami
            const permissions = await response.json();

            // 3. Wyświetl dane do debugowania
            document.getElementById('permissions-debug').textContent = JSON.stringify(permissions, null, 2);
            document.getElementById('username-display').textContent = permissions.username;


            // 4. Użyj uprawnień do dynamicznego pokazywania/ukrywania elementów
            if (permissions.isAdmin) {
                document.getElementById('admin-link').style.display = 'inline';
            }
            
            if (permissions.isTherapist) {
                document.getElementById('therapist-link').style.display = 'inline';
            }

            if (permissions.isDriver) {
                document.getElementById('driver-link').style.display = 'inline';
            }

        } catch (error) {
            console.error('Nie udało się pobrać uprawnień użytkownika:', error);
            document.getElementById('permissions-debug').textContent = `Błąd: ${error.message}`;
        }
    }
</script>
